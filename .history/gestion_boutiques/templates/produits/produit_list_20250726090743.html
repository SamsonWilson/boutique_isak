{% extends "base.html" %}
{% load static %}

{% block title %}Tableau de Bord - Gestion multi-boutiques{% endblock %}

{% block content %}

<style>
/* =================================================================== */
/*  1. STYLES GÉNÉRAUX ET MISE EN PAGE
/* =================================================================== */
body { 
    background: #f6f8fb; 
    font-family: Inter, sans-serif;
    margin: 0; 
}
.container { 
    max-width: 1400px; 
    margin: 30px auto; 
    padding: 0 15px; /* Ajout d'un padding pour les petits écrans */
}

/* =================================================================== */
/*  2. STYLE DES CARTES (CARDS)
/* =================================================================== */
.card {
    background: #fff;
    border-radius: 14px;
    box-shadow: 0 2px 20px rgba(219, 230, 255, 0.5);
    margin-bottom: 28px;
    padding: 22px;
}
.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid #f1f3f9;
}
.card-header h2 {
    margin: 0;
    color: #233c59;
    font-size: 1.25rem;
}
.card-header h2 .fa {
    margin-right: 10px;
    color: #4361ee;
}

/* =================================================================== */
/*  3. STYLE DES TABLEAUX (MODIFIÉ POUR LE DÉFILEMENT VERTICAL)
/* =================================================================== */
.table-wrapper {
    /* MODIFIÉ: Ajout d'une hauteur maximale et gestion du défilement vertical */
    max-height: 300px; /* <-- NOUVEAU: Définissez ici la hauteur que vous souhaitez pour vos tableaux */
    overflow: auto; /* Permet le défilement horizontal ET vertical */
    overscroll-behavior-x: contain;
    position: relative; /* Contexte pour l'en-tête sticky */
}
table {
    width: 100%;
    border-collapse: collapse;
    background: #fff;
    white-space: nowrap; /* Empêche le retour à la ligne dans les cellules */
}
th, td {
    padding: 14px 12px;
    border-bottom: 1px solid #eaeaea;
    text-align: left;
    vertical-align: middle;
}
th {
    font-weight: 600;
    color: #4361ee;
    
    /* NOUVEAU: Ces propriétés rendent l'en-tête "collant" en haut du tableau lors du défilement */
    position: sticky;
    top: 0;
    background: #f1f3f9; /* Le fond est essentiel pour masquer le contenu qui défile en dessous */
    z-index: 2; /* S'assure que l'en-tête reste au-dessus du contenu */
}
tr:last-child td {
    border-bottom: none;
}
tr:hover {
    background: #f1f6ff;
}

/* =================================================================== */
/*  4. STYLE DES BOUTONS
/* =================================================================== */
.btn-primary {
    background-color: #4361ee;
    color: white;
    padding: 10px 18px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-weight: 500;
    transition: background-color 0.2s;
}
.btn-primary:hover {
    background-color: #3b5bdb;
}

/* Boutons d'action circulaires dans les tableaux */
.actions {
    display: flex;
    align-items: center;
    gap: 8px;
}
.actions .btn-action {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 34px;
    height: 34px;
    border-radius: 50%;
    text-decoration: none;
    transition: background-color 0.2s ease;
    font-size: 1rem;
}
.actions .btn-action-edit { color: #4361ee; }
.actions .btn-action-edit:hover { background-color: #eef2ff; }
.actions .btn-action-delete { color: #e53e3e; }
.actions .btn-action-delete:hover { background-color: #fff1f1; }

/* =================================================================== */
/*  5. STYLE DES CARTES DE STATISTIQUES (STAT-CARDS)
/* =================================================================== */
.stat-cards-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 20px;
    margin-bottom: 28px;
}
.stat-card {
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 2px 8px #e5ecfa;
    padding: 22px;
}
.stat-card-head {
    font-size: 0.9em;
    color: #9ea4b1;
    margin-bottom: 12px;
    font-weight: 500;
}
.stat-card-body {
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
}
.stat-value {
    font-size: 2.2rem;
    color: #384052;
    font-weight: 700;
    line-height: 1;
}
.stat-icon {
    font-size: 1.8rem;
    color: #38d39f;
}
.stat-icon.down { color: #ff4d6d; }
.stat-icon.db { color: #4361ee; }
.stat-icon.stock { color: #f9a63a; }

/* =================================================================== */
/*  6. STYLE DE LA FENÊTRE MODALE
/* =================================================================== */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(35, 60, 89, 0.6);
    backdrop-filter: blur(4px); /* Effet de flou moderne */
}
.modal-content {
    background-color: #fff;
    margin: 10% auto;
    padding: 30px;
    border: none;
    width: 90%;
    max-width: 600px;
    border-radius: 14px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    position: relative;
}
.close-button {
    color: #aaa;
    position: absolute;
    top: 15px;
    right: 20px;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    transition: color 0.2s;
}
.close-button:hover,
.close-button:focus {
    color: #333;
    text-decoration: none;
}

</style>

<div class="container">
  
    <!-- Section 1 : Cartes de Statistiques -->
    <div class="stat-cards-row">
      <div class="stat-card">
        <div class="stat-card-head">PRODUITS UNIQUES</div>
        <div class="stat-card-body">
          <span class="stat-value">{{ produits.count|default:"0" }}</span>
          <i class="fa fa-box stat-icon db"></i>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-card-head">STOCKS ENREGISTRÉS</div>
        <div class="stat-card-body">
          <span class="stat-value">{{ stocks.count|default:"0" }}</span>
          <i class="fa fa-warehouse stat-icon stock"></i>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-card-head">TOTAL VENTES (Exemple)</div>
        <div class="stat-card-body">
          <span class="stat-value">1,254€</span>
          <i class="fa fa-arrow-trend-up stat-icon"></i>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-card-head">CLIENTS (Exemple)</div>
        <div class="stat-card-body">
          <span class="stat-value">89</span>
          <i class="fa fa-users stat-icon down"></i>
        </div>
      </div>
    </div>

    <!-- Section 2 : Gestion des Stocks -->
    <div class="card">
        <div class="card-header">
            <h2><i class="fa fa-warehouse"></i>Gestion des Stocks</h2>
            <a href="{% url 'stock_add' %}" class="btn-primary" id="open-modal-btn" class="btn-primary">
                <i class="fa fa-plus"></i>
                <span>Ajouter un stock</span>
            </a>
        </div>
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Boutique</th><th>Produit</th><th>Quantité</th><th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for stock in stocks %}
                    <tr>
                        <td>{{ stock.boutique }}</td>
                        <td>{{ stock.produit }}</td>
                        <td>{{ stock.quantite }}</td>
                        <td class="actions">
                            <a href="{% url 'stock_edit' stock.id %}" class="btn-action btn-action-edit" title="Modifier"><i class="fa fa-edit"></i></a>
                            <a href="{% url 'stock_delete' stock.id %}" class="btn-action btn-action-delete" title="Supprimer"><i class="fa fa-trash"></i></a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="4" style="text-align:center; padding: 40px;">Aucun stock trouvé.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
  
    <!-- Section 3 : Gestion des Produits -->
    <div class="card">
        <div class="card-header">
            <h2><i class="fa fa-database"></i>Catalogue des Produits</h2>
            <button id="open-modal-btn" class="btn-primary">
                <i class="fa fa-plus"></i>
                <span>Ajouter un produit</span>
            </button>
        </div>
        <div class="table-wrapper">
            <table>
                <thead>
                  <tr>
                    <th>Nom</th><th>Description</th><th>Prix Unitaire (€)</th><th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                    {% for produit in produits %}
                      <tr>
                        <td>{{ produit.nom }}</td>
                        <td>{{ produit.description|truncatechars:40 }}</td>
                        <td>{{ produit.prix_unitaire }}</td>
                        <td class="actions">
                            <a href="{% url 'produit_update' produit.id %}" class="btn-action btn-action-edit" title="Modifier"><i class="fa fa-edit"></i></a>
                            <a href="{% url 'produit_delete' produit.id %}" class="btn-action btn-action-delete" title="Supprimer"><i class="fa fa-trash"></i></a>
                        </td>
                      </tr>
                    {% empty %}
                      <tr><td colspan="4" style="text-align:center; padding: 40px;">Aucun produit trouvé.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- =========== Fenêtre Modale pour l'ajout de produit =========== -->
<div id="product-modal" class="modal">
  <div class="modal-content">
    <span class="close-button">×</span>
    <div id="modal-body">
        <p>Chargement...</p>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    
    // --- GESTION DE LA MODALE POUR AJOUTER UN PRODUIT ---
    const modal = document.getElementById('product-modal');
    const openBtn = document.getElementById('open-modal-btn');
    const openBtn = document.getElementById('open-modal-btn');
    const closeBtn = document.querySelector('.close-button');
    const modalBody = document.getElementById('modal-body');

    if(openBtn) {
        const createFormUrl = "{% url 'produit_create' %}";

        const openModal = () => {
            modal.style.display = 'block';
            fetch(createFormUrl)
                .then(response => response.text())
                .then(html => {
                    modalBody.innerHTML = html;
                    const form = modalBody.querySelector('form');
                    form.addEventListener('submit', handleFormSubmit);
                })
                .catch(error => {
                    modalBody.innerHTML = "<p>Erreur de chargement du formulaire.</p>";
                    console.error('Error fetching form:', error);
                });
        };

        const closeModal = () => {
            modal.style.display = 'none';
            modalBody.innerHTML = '<p>Chargement...</p>';
        };

        const handleFormSubmit = (event) => {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);

            fetch(form.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': form.querySelector('[name=csrfmiddlewaretoken]').value
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    closeModal();
                    location.reload();
                } else {
                    modalBody.innerHTML = data.form_html;
                    modalBody.querySelector('form').addEventListener('submit', handleFormSubmit);
                }
            })
            .catch(error => console.error('Error submitting form:', error));
        };

        openBtn.addEventListener('click', openModal);
        closeBtn.addEventListener('click', closeModal);

        window.addEventListener('click', (event) => {
            if (event.target === modal) {
                closeModal();
            }
        });
    }

    // --- AMÉLIORATION : DÉFILEMENT HORIZONTAL DES TABLEAUX AVEC LA MOLETTE ---
    const tableWrappers = document.querySelectorAll('.table-wrapper');
    tableWrappers.forEach(wrapper => {
        wrapper.addEventListener('wheel', (event) => {
            if (event.deltaY !== 0 && wrapper.scrollWidth > wrapper.clientWidth) { // S'active seulement si le scroll horizontal est possible
                event.preventDefault();
                wrapper.scrollLeft += event.deltaY;
            }
        });
    });

});
</script>
{% endblock %}
{% comment %} 
{% extends "base.html" %}
{% load static %}

{% block title %}Liste des Produits - Gestion multi-boutiques{% endblock %}

{% block content %}
{# Nous n'avons plus besoin de charger static ici car c'est déjà fait en haut #}
{# Nous n'avons plus besoin des balises <html>, <head>, <body> car elles viennent de "base.html" #}

<style>
    /* Styles de la page (inchangés) */
    body { background: #f6f8fb; font-family: Inter, sans-serif; margin:0; }
    .container { max-width:1400px; margin:30px auto; }
    .card { border-radius:14px; box-shadow:0 2px 20px #dbe6ff80; background:#fff; margin-bottom:28px; padding:22px; }
    .dashboard-grid { display:flex; gap:34px; }
    .col { flex:1; min-width:0;}
    .table-wrapper { overflow:auto; margin-bottom:24px; }
    table { width: 100%; border-collapse:collapse; background:#fff; }
    thead { background: #f1f3f9;}
    th, td { padding: 13px 10px; border-bottom:1px solid #eaeaea;}
    th { font-weight:600; color: #4361ee; }
    tr:hover { background: #f1f6ff;}
    /* ================================================= */
/* AJOUTEZ CE BLOC CSS DANS VOTRE BALISE <style> */
/* ================================================= */

/* Conteneur pour les boutons dans la cellule du tableau */
.actions {
    display: flex;
    align-items: center;
    gap: 8px; /* Crée un espace propre entre les boutons */
}

/* Style de base pour chaque bouton d'action */
.actions .btn-action {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 34px;
    height: 34px;
    border-radius: 50%; /* Pour obtenir un cercle parfait */
    text-decoration: none;
    transition: background-color 0.2s ease;
    font-size: 1rem;
    color: #3b5bdb; /* Couleur de base pour l'icône */
}

/* Style spécifique pour le bouton "Modifier" au survol */
.actions .btn-action-edit:hover {
    background-color: #eef2ff; /* Fond bleu très clair au survol */
    color: #4361ee;
}

/* Style spécifique pour le bouton "Supprimer" */
.actions .btn-action-delete {
    color: #e53e3e; /* Couleur de l'icône (rouge pour danger) */
}

.actions .btn-action-delete:hover {
    background-color: #fff1f1; /* Fond rouge très clair au survol */
}
    /* NOUVEAUX STYLES POUR LA FENÊTRE MODALE */
    .modal {
        display: none; /* Cachée par défaut */
        position: fixed; /* Reste en place même si on scrolle */
        z-index: 1000; /* Se place au-dessus de tout le reste */
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto; /* Permet de scroller si le contenu est trop grand */
        background-color: rgba(0,0,0,0.5); /* Fond noir semi-transparent */
    }

    .modal-content {
        background-color: #fff;
        margin: 10% auto; /* 10% du haut et centré horizontalement */
        padding: 25px;
        border: 1px solid #888;
        width: 80%;
        max-width: 600px; /* Largeur maximale */
        border-radius: 14px;
        box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
        position: relative; /* Pour positionner le bouton de fermeture */
    }

    .close-button {
        color: #aaa;
        position: absolute;
        top: 10px;
        right: 20px;
        font-size: 28px;
        font-weight: bold;
    }

    .close-button:hover,
    .close-button:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    .btn-primary {
        background-color: #4361ee;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
    }
    .btn-primary:hover {
        background-color: #3b5bdb;
    }
      
.stat-cards-row {
    display: flex;
    gap: 18px;
    padding: 18px;
    background: #f7f8fa;
    max-width: 1700px;
    margin: auto;
}

.stat-card {
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 2px 8px #e5ecfa;
    min-width: 260px;
    flex: 1 1 0;
    padding: 22px 24px 12px 24px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    min-height: 110px;
}

.stat-card-head {
    font-size: .97em;
    color: #9ea4b1;
    letter-spacing: 0.02em;
    margin-bottom: 7px;
    font-weight: 450;
}
.stat-card-body {
    display: flex;
    align-items: center;
    justify-content: space-between;
    min-height: 45px;
}
.stat-value {
    font-size: 2.05em;
    color: #384052;
    font-weight: 700;
    letter-spacing: 0.01em;
}
.stat-value.big { font-size: 2em; }
.stat-pct {
    color: #bac0cd;
    font-size: 0.6em;
    font-weight: 500;
    margin-left: 3px;
}
.stat-pct.hires { color: #bac0cd;font-size: 1em;}
.stat-icon {
    font-size: 2em;
    vertical-align: middle;
    padding-right: 7px;
}
.stat-icon.up { color: #38d39f; }
.stat-icon.down { color: #ff4d6d; }
.stat-icon.plus { color: #38d39f;font-size:1.7em;}
.stat-dollar {
    color: #fed042;
    font-weight: bold;
    font-size: 1.35em;
    margin-right: 4px; 
}
.stat-value.hires { font-size: 2em;}
.stat-circular {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    width: 44px; height: 44px;
    border-radius: 50%;
    background: #f7f8fa;
    font-size: 1em;
    font-weight: bold;
    box-shadow: 0 0 0 3px #eee;
    position: relative;
    margin-left: 18px;
}
.stat-circular span { font-size: 1em; }
.stat-circular.stat-blue  { box-shadow: 0 0 0 3px #2e86ff;}
.stat-circular.stat-red   { box-shadow: 0 0 0 3px #ea4e51;}
.stat-circular.stat-orange{ box-shadow: 0 0 0 3px #ffa700;}
.stat-circular.stat-green { box-shadow: 0 0 0 3px #42e695;}
.stat-bar {
    margin-top:14px;
    height: 4px;
    border-radius: 2px;
    width: 100%;
    background: #e7ecf3;
}
.stat-bar.stat-blue   { background: #2e86ff;}
.stat-bar.stat-red    { background: #ea4e51;}
.stat-bar.stat-orange { background: #ffa700;}
.stat-bar.stat-green  { background: #42e695;}
@media(max-width:1000px){
  .stat-cards-row { flex-direction: column;}
  .stat-card { margin-bottom: 16px;}
}
</style>
<div class="stat-cards-row">
  <!-- CARD 1 -->
  <div class="stat-card">
    <div class="stat-card-head">NEW ACCOUNTS</div>
    <div class="stat-card-body">
      <span class="stat-icon up">&#9650;</span>
      <span class="stat-value">234 <span class="stat-pct">%</span></span>
      <span class="stat-circular stat-blue"><span>58</span></span>
    </div>
    <div class="stat-bar stat-blue"></div>
  </div>
  <!-- CARD 2 -->
  <div class="stat-card">
    <div class="stat-card-head">TOTAL EXPENSES</div>
    <div class="stat-card-body">
      <span class="stat-icon down">&#9660;</span>
      <span class="stat-value">71 <span class="stat-pct">%</span></span>
      <span class="stat-circular stat-red"><span>62</span></span>
    </div>
    <div class="stat-bar stat-red"></div>
  </div>
  <!-- CARD 3 -->
  <div class="stat-card">
    <div class="stat-card-head">COMPANY VALUE</div>
    <div class="stat-card-body">
      <span class="stat-dollar">$</span>
      <span class="stat-value big">1,45M</span>
      <span class="stat-circular stat-orange"><span>72</span></span>
    </div>
    <div class="stat-bar stat-orange"></div>
  </div>
  <!-- CARD 4 -->
  <div class="stat-card">
    <div class="stat-card-head">NEW EMPLOYEES</div>
    <div class="stat-card-body">
      <span class="stat-icon plus">+</span>
      <span class="stat-value hires">34 <span class="stat-pct hires">hires</span></span>
      <span class="stat-circular stat-green"><span>81</span></span>
    </div>
    <div class="stat-bar stat-green"></div>
  </div>
</div>
<style>
</style>
<div class="container">
  
    <!-- Tableau Produits -->
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <h2 style="margin: 0; color:#233c59"><i class="fa fa-database"></i> Produits</h2>
            <!-- MODIFICATION : On change le <a> pour un <button> et on lui donne un ID -->
            <button id="open-modal-btn" class="btn-primary">Ajouter un produit</button>
        </div>

        <div class="table-wrapper">
            <table>
                <thead>
                  <tr>
                    <th>Nom</th>
                    <th>Description</th>
                    <th>Prix Unitaire (€)</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                    {% for produit in produits %}
                      <tr>
                        <td>{{ produit.nom }}</td>
                        <td>{{ produit.description|truncatechars:32 }}</td>
                        <td>{{ produit.prix_unitaire }}
                          
                        </td>
                        <td class="actions">
                       <a href="#" class="btn btn-outline-secondary"><i class="fa fa-edit"></i> Secondary</a>
                        <a href="#" class="btn btn-outline-success"><i class="fa fa-edit"></i> Success</a>
<a href="#" class="btn btn-outline-info"><i class="fa fa-edit"></i> Info</a>
<a href="{% url 'produit_delete' produit.id %}" class="btn btn-outline-warning" title="Supprimer">
    <i class="fa fa-trash"></i> Warning
</a>
                        </td>
                      </tr>
                    {% empty %}
                      <tr>
                        <td colspan="4" style="text-align:center">Aucun produit</td>
                      </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- =========== LA STRUCTURE DE LA MODALE =========== -->
<div id="product-modal" class="modal">
  <div class="modal-content">
    <span class="close-button">×</span>
    <div id="modal-body">
        <!-- Le contenu du formulaire sera chargé ici par JavaScript -->
        <p>Chargement du formulaire...</p>
    </div>
  </div>
</div>


<script>
document.addEventListener('DOMContentLoaded', function () {
    // Récupérer les éléments de la modale
    const modal = document.getElementById('product-modal');
    const openBtn = document.getElementById('open-modal-btn');
    const closeBtn = document.querySelector('.close-button');
    const modalBody = document.getElementById('modal-body');

    // URL pour récupérer le formulaire de création
    const createFormUrl = "{% url 'produit_create' %}";

    // Fonction pour ouvrir la modale et charger le formulaire
    const openModal = () => {
        modal.style.display = 'block';
        // Utilise fetch pour récupérer le formulaire depuis la vue Django
        fetch(createFormUrl)
            .then(response => response.text())
            .then(html => {
                modalBody.innerHTML = html;
                // Attacher l'événement de soumission au nouveau formulaire
                const form = modalBody.querySelector('form');
                form.addEventListener('submit', handleFormSubmit);
            })
            .catch(error => {
                modalBody.innerHTML = "<p>Erreur lors du chargement du formulaire.</p>";
                console.error('Error fetching form:', error);
            });
    };

    // Fonction pour fermer la modale
    const closeModal = () => {
        modal.style.display = 'none';
        modalBody.innerHTML = '<p>Chargement du formulaire...</p>'; // Réinitialiser le contenu
    };

    // Gérer la soumission du formulaire via AJAX
    const handleFormSubmit = (event) => {
        event.preventDefault(); // Empêche la soumission classique de la page
        const form = event.target;
        const formData = new FormData(form);

        fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: {
                // Django a besoin de ce header pour la protection CSRF avec AJAX
                'X-CSRFToken': form.querySelector('[name=csrfmiddlewaretoken]').value
            }
        })
        .then(response => response.json()) // On attend une réponse JSON du serveur
        .then(data => {
            if (data.success) {
                closeModal();
                location.reload(); // Recharger la page pour voir le nouveau produit
            } else {
                // Si la soumission a échoué (ex: validation), on réaffiche le formulaire avec les erreurs
                modalBody.innerHTML = data.form_html;
                 // Il faut ré-attacher l'événement car le contenu a été remplacé
                const newForm = modalBody.querySelector('form');
                newForm.addEventListener('submit', handleFormSubmit);
            }
        })
        .catch(error => {
            console.error('Error submitting form:', error);
            alert("Une erreur s'est produite. Veuillez réessayer.");
        });
    };

    // Événements
    openBtn.addEventListener('click', openModal);
    closeBtn.addEventListener('click', closeModal);

    // Fermer la modale si l'utilisateur clique en dehors de la boîte de contenu
    window.addEventListener('click', (event) => {
        if (event.target === modal) {
            closeModal();
        }
    });
});
</script>

{% endblock %}
{% comment %} {% extends "base.html" %}
{% load static %}

{% block title %}Nouvelle Vente - Gestion multi-boutiques{% endblock %}

{% block content %}

<h1>Liste des produits</h1>
<a href="{% url 'produit_create' %}">Ajouter un produit</a>
<ul>
  {% for produit in produits %}
    <li>
      <a href="{% url 'produit_detail' produit.pk %}">{{ produit.nom }}</a>
      - {{ produit.prix_unitaire }}€
      <a href="{% url 'produit_update' produit.pk %}">Modifier</a>
      <a href="{% url 'produit_delete' produit.pk %}">Supprimer</a>
    </li>
  {% empty %}
    <li>Aucun produit.</li>
  {% endfor %}
</ul>
{% endblock %}  {% endcomment %}
